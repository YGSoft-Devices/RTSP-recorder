# Internationalisation (i18n)

## Objectif
Ce document explique comment gérer les traductions de l’interface Web RTSP Recorder, ajouter une langue et exécuter les tests i18n.

---

## Emplacement des fichiers de traduction

- Traductions intégrées (repo) :
  - `web-manager/static/locales/fr.json`
  - `web-manager/static/locales/en.json`

- Traductions personnalisées (device) :
  - `/etc/rpi-cam/locales/<lang>.json`

Les traductions personnalisées **surchargent** les traductions intégrées.

---

## Règles de nommage des clés

- Utiliser une notation en points, stable et lisible :
  - `common.save`
  - `nav.home`
  - `rtsp.parameters.fps`
  - `i18n.validation_failed`
- Éviter les clés basées sur le texte brut.
- Conserver les clés existantes lors des refactors.

---

## Sélection de la langue

Priorité de sélection (serveur) :
1. Query param `?lang=fr`
2. Cookie `language`
3. Header `Accept-Language`
4. Variable d’environnement `WEB_LANGUAGE` (optionnel)
5. Clé de configuration `WEB_LANGUAGE` dans `/etc/rpi-cam/config.env`
6. Défaut : `fr`

Côté frontend :
- Le sélecteur de langue enregistre la préférence via cookie + localStorage.
- Le serveur sert le HTML avec `lang` correspondant.

---

## Ajouter une nouvelle langue

1. Copier `web-manager/static/locales/en.json` vers `web-manager/static/locales/<lang>.json`
2. Mettre à jour :
   - `_meta.language`
   - `_meta.code`
   - `_meta.version`
3. Traduire toutes les clés.
4. Tester l’interface.

Pour déployer une traduction personnalisée sur le device :
- Uploader le JSON via l’onglet “Avancé” → Langue
- Ou déposer le fichier directement dans `/etc/rpi-cam/locales/`

---

## Tests

### Tests unitaires (i18n)

```bash
C:/Users/sn8k/Documents/gitHub/RTSP-Full/RTSP-recorder/.venv/Scripts/python.exe -m pytest -q tests/test_i18n_service.py
```

### Scanner i18n (chaînes non traduites)

```bash
C:/Users/sn8k/Documents/gitHub/RTSP-Full/RTSP-recorder/.venv/Scripts/python.exe -m pytest -q tests/test_i18n_scanner.py
```

---

## Bonnes pratiques

- Garder tous les fichiers en UTF-8.
- Utiliser `{{variable}}` pour l’interpolation côté JS, et `{variable}` ou `{{variable}}` côté Python.
- Éviter les chaînes en dur dans les templates et JS (préférer `data-i18n`).
